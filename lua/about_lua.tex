%--template 'template.tex' --def title='Краткий путеводитель по Луне 5.1' --def author='\we'

\section{Требования к Луне}
Ряд требований к использованию Lua:
\begin{itemize}
\item использование в разных контекстах с разным количеством возможностей;
\item параллельное использование из нескольких потоков;
\item локализация;
\item фасад (один или несколько) для встраивания;
\item описание языка по ГОСТ для пользователей;
\end{itemize}

\section{Архитектура Lua}

На самом высоком уровне абстракции выделяются два компонента: реализация собственно языка (ядро) и реализация его стандартной библиотеки. Ядро не зависит от стандартной библиотеки и его можно рассматривать отдельно (рис. \ref{fig:lua_arch_pict}).

Логически ядро можно представить в виде таких компонентов (деление в первую очередь основано на наличии доступа из C):
\begin{itemize}
\item{}Виртуальная машина. Включает в себя интерпретатор байт-кода, управление стеком и состоянием. Интерпретатор (``виртуальная машина'') в Lua для хранения операндов инструкций использует регистры. Количество инструкций "--- 38.
\item{}Компилятор. Состоит из лексера, парсера и генератора байт-кода. В Lua используются написанные вручную лексер и парсер (в ранних версиях Lua использовался парсер, сгенерированный yacc). Поскольку парсер делает всего один проход инструкции байт-кода генерируются ``на лету'' по мере парсинга исходного кода. Оптимизация байт-кода, таким образом, практически не выполняется.
\item{}Сборщик мусора. В Lua используется инкрементный сборщик мусора, благодаря чему значительно сокращается время, затрачиваемое на уборку. Сборщик мусора начинает работу при достижении некоторого порогового количества выделенной памяти.
\item{}Базовые сервисы. Реализуют функции управления памятью, создания строк, управления таблицами и представляют интерфейс буферизованного потока.
\item{}Вспомогательные функции. Преобразуют байт-код в форму, подходящую для сохранения его на диске или в памяти. Также выполняют обратное преобразование.
\end{itemize}

\begin{figure}[htbp]
\centering
\includegraphics[bb = 20 500 575 822, scale = 0.9]{about_lua_arch.eps}
\caption{Архитектура Lua} \label{fig:lua_arch_pict}
\end{figure}


\section{Организация исходного кода}

Организация исходного кода отражает архитектуру пакетов, представленную на рис. \ref{fig:lua_arch_pict}.
\begin{itemize}
\item{}Виртуальная машина "--- \lstinline|lstate.c, ldo.c, lvm.c|.
\item{}Компилятор "--- \lstinline|llex.c, lparser.c, lcode.c|.
\item{}Сборщик мусора "--- \lstinline|lgc.c|.
\item{}Базовые сервисы "--- \lstinline|lmem.c, lstring.c, ltable.c, lzio.c|.
\item{}Вспомогательные функции "--- \lstinline|ldump.c, lundump.c|.
\end{itemize}

Оставшиеся файлы исходного кода содержат:
\begin{itemize}
\item{}C API "--- \lstinline|lapi.c, lauxlib.c|.
\item{}Стандартная библиотека "--- \lstinline|lbaselib.c, ldblib.c, linit.c, liolib.c, lmathlib.c, loadlib.c, loslib.c, lstrlib.c, ltablib.c|.
\item{}Функции общего назначения "--- \lstinline|lfunc.c, lobject.c, lopcodes.c, ltm.c|. Используются несколькими компонентами.
\end{itemize}

